# Бенчмарки для light-observable-ts

Этот проект содержит набор бенчмарков для измерения производительности библиотеки light-observable-ts. Бенчмарки разделены на несколько категорий для тестирования различных аспектов библиотеки.

## Установка зависимостей

Перед запуском бенчмарков необходимо установить зависимости:

```bash
npm install --save-dev benchmark microtime
```

Для запуска сравнительных бенчмарков с RxJS также необходимо установить:

```bash
npm install --save-dev rxjs
```

## Запуск бенчмарков

В проекте доступны следующие скрипты для запуска бенчмарков:

```bash
# Запуск основных бенчмарков
npm run benchmark

# Запуск сравнительных бенчмарков с RxJS
npm run benchmark:comparison

# Запуск бенчмарков для тестирования оптимизаций
npm run benchmark:optimizations
```

## Описание бенчмарков

### Основные бенчмарки (benchmark.ts)

1. **Создание Observable** - измеряет скорость создания экземпляров Observable и OrderedObservable.
2. **Подписка на Observable** - измеряет скорость подписки на Observable с разным количеством подписчиков.
3. **Метод next** - измеряет скорость эмиссии значений с разным количеством подписчиков.
4. **Метод stream** - измеряет скорость потоковой передачи массивов значений.
5. **Pipe и фильтры** - измеряет производительность различных операций pipe и фильтрации.
6. **OrderedObservable** - измеряет производительность операций с упорядоченными наблюдаемыми.
7. **Collector** - измеряет производительность операций с коллектором подписок.
8. **Вспомогательные функции** - сравнивает производительность различных вспомогательных функций.
9. **Сравнение производительности при разных нагрузках** - измеряет производительность при различных уровнях нагрузки.

### Сравнительные бенчмарки (benchmark-comparison.ts)

Сравнивает производительность light-observable-ts с RxJS в следующих сценариях:

1. **Создание и подписка** - сравнивает скорость создания и подписки.
2. **Эмиссия значений** - сравнивает скорость эмиссии 100 значений.
3. **Фильтрация и трансформация** - сравнивает скорость фильтрации и трансформации значений.

### Бенчмарки оптимизаций (benchmark-optimizations.ts)

Тестирует потенциальные оптимизации библиотеки:

1. **quickDeleteFromArray** - сравнивает текущую и оптимизированную реализации.
2. **OrderedObservable.sortByOrder** - сравнивает текущую реализацию с оптимизированной версией, использующей флаг needsResorting.
3. **Collector.unsubscribeAll** - сравнивает текущую реализацию с оптимизированной версией, использующей обратный цикл for.
4. **Обработка фильтров** - сравнивает текущую реализацию с оптимизированной версией, использующей ранний возврат.

## Интерпретация результатов

После запуска бенчмарков вы увидите результаты в консоли. Для каждого теста будет показано:

- Название теста
- Количество операций в секунду (ops/sec)
- Погрешность измерения (±)
- Количество запусков (runs sampled)
- Самый быстрый вариант (Fastest is)

Пример вывода:

```
# Создание Observable
new Observable x 1,234,567 ops/sec ±1.23% (98 runs sampled)
new OrderedObservable x 987,654 ops/sec ±2.34% (95 runs sampled)
Fastest is new Observable
```

## Добавление новых бенчмарков

Для добавления новых бенчмарков можно использовать функцию `runBenchmark` из файла benchmark.ts:

```typescript
runBenchmark('Название бенчмарка', {
  'Тест 1': () => {
    // Код теста 1
  },
  'Тест 2': () => {
    // Код теста 2
  }
});
```

## Советы по оптимизации

На основе результатов бенчмарков можно выявить узкие места в производительности библиотеки и предложить оптимизации. Некоторые потенциальные оптимизации уже реализованы в файле benchmark-optimizations.ts.